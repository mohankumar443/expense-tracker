<div *ngIf="showComparison" class="mb-8 animate-fade-in-up">
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-black text-gray-900 dark:text-white flex items-center">
            Financial Life OS — Analytics
        </h2>
    </div>

    <!-- Top Stats Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Debt Increased/Decreased Card -->
        <div
            class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800 relative overflow-hidden group hover:border-gray-700 transition-all">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <span class="material-icons text-6xl text-orange-500">trending_up</span>
            </div>
            <p class="text-xs font-bold text-orange-400 uppercase tracking-wider mb-2">Debt {{ isImprovement() ?
                'Decreased' : 'Increased' }}</p>
            <div class="flex items-baseline gap-2">
                <span class="material-icons text-2xl"
                    [class]="isImprovement() ? 'text-emerald-400' : 'text-orange-400'">
                    {{ isImprovement() ? 'arrow_downward' : 'arrow_upward' }}
                </span>
                <h3 class="text-4xl font-black text-white">
                    ${{ animatedDebtChange | number:'1.0-0' }}
                </h3>
            </div>
            <p class="text-xs text-gray-400 mt-2">{{ animatedPercentChange | number:'1.2-2' }}% change from ${{
                previousMonthSummary?.totalDebt | number:'1.0-0' }}</p>
        </div>

        <!-- Monthly Interest Card -->
        <div
            class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800 relative overflow-hidden group hover:border-gray-700 transition-all">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <span class="material-icons text-6xl text-amber-500">payments</span>
            </div>
            <p class="text-xs font-bold text-amber-400 uppercase tracking-wider mb-2">Monthly Interest</p>
            <div class="flex items-baseline gap-2">
                <span class="material-icons text-amber-400 text-2xl">check_box_outline_blank</span>
                <h3 class="text-4xl font-black text-white">
                    ${{ animatedInterest | number:'1.0-0' }}
                </h3>
            </div>
            <p class="text-xs text-gray-400 mt-2">Estimated cost of debt</p>
        </div>

        <!-- Debt Free Date Card -->
        <div
            class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800 relative overflow-hidden group hover:border-gray-700 transition-all">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <span class="material-icons text-6xl text-purple-500">event</span>
            </div>
            <p class="text-xs font-bold text-purple-400 uppercase tracking-wider mb-2">Debt Free Date</p>
            <div class="flex items-baseline gap-2">
                <span class="material-icons text-purple-400 text-2xl">event_available</span>
                <h3 class="text-3xl font-black text-white">
                    {{ projectedDebtFreeDate ? (projectedDebtFreeDate | date:'MMM yyyy') : 'N/A' }}
                </h3>
            </div>
            <p class="text-xs text-gray-400 mt-2">Based on current payoff</p>
        </div>

        <!-- Total Debt Card -->
        <div
            class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800 relative overflow-hidden group hover:border-gray-700 transition-all">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <span class="material-icons text-6xl text-blue-500">account_balance</span>
            </div>
            <p class="text-xs font-bold text-blue-400 uppercase tracking-wider mb-2">Total Debt</p>
            <div class="flex items-baseline gap-2">
                <span class="material-icons text-blue-400 text-2xl">account_balance_wallet</span>
                <h3 class="text-4xl font-black text-white">
                    ${{ currentMonthSummary?.totalDebt | number:'1.0-0' }}
                </h3>
            </div>
            <p class="text-xs text-gray-400 mt-2">Current Balance</p>
        </div>
    </div>

    <!-- Main Dashboard Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Left Column -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Interest Projection Heatmap -->
            <div class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800">
                <h3 class="text-lg font-bold text-white mb-4">Monthly Interest Cost</h3>
                <div class="h-64 w-full">
                    <canvas baseChart [data]="interestChartData" [options]="interestChartOptions" [type]="barChartType">
                    </canvas>
                </div>

                <!-- Legend -->
                <div class="mt-6 pt-4 border-t border-gray-800">
                    <p class="text-xs text-gray-400 mb-3 font-semibold uppercase tracking-wider">Interest Ranges</p>
                    <div class="space-y-2">
                        <!-- Gradient Bar -->
                        <div class="h-2 rounded-full w-full"
                            style="background: linear-gradient(to right, #10b981, #84cc16, #f59e0b, #ef4444);"></div>

                        <!-- Min/Max Labels -->
                        <div class="flex justify-between text-xs text-gray-400 font-medium">
                            <span>Low (${{ minInterest | number:'1.0-0' }})</span>
                            <span>High (${{ maxInterest | number:'1.0-0' }})</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Heatmap & YTD Progress -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Risk Heatmap -->
                <div class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800">
                    <h3 class="text-lg font-bold text-white mb-4">Risk Heatmap</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div *ngFor="let acc of highAprAccounts"
                            class="bg-[#1e293b] p-4 rounded-xl border border-gray-700">
                            <p class="text-xs text-orange-300 font-bold mb-1">{{ acc.name }}</p>
                            <div class="flex justify-between items-end">
                                <span class="text-xl font-black text-white">{{ acc.apr }}%</span>
                                <span class="text-xs text-gray-400">${{ acc.currentBalance | number:'1.0-0' }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- YTD Progress -->
                <div class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800">
                    <h3 class="text-lg font-bold text-white mb-4">YTD Progress</h3>
                    <h2 class="text-3xl font-black text-white mb-4">$20,300</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between text-xs text-gray-400">
                            <span>Principal</span>
                            <span class="text-white font-bold">113,100</span>
                        </div>
                        <div class="flex justify-between text-xs text-gray-400">
                            <span>Interest</span>
                            <span class="text-white font-bold">5,200</span>
                        </div>
                        <div class="h-2 bg-gray-700 rounded-full overflow-hidden mt-2">
                            <div class="h-full bg-emerald-500 w-3/4"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Trend -->
            <div class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800">
                <h3 class="text-lg font-bold text-white mb-4">Debt by Category</h3>
                <div class="space-y-4">
                    <div *ngFor="let category of categoryTrendData"
                        class="bg-[#1e293b] rounded-xl p-5 border border-gray-700 hover:border-gray-600 transition-all">
                        <!-- Category Header -->
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-3 h-3 rounded-full" [style.background-color]="category.color"></div>
                                <p class="text-sm font-bold text-white">{{ category.name }}</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="material-icons text-lg"
                                    [class]="category.isImproving ? 'text-emerald-400' : 'text-rose-400'">
                                    {{ category.isImproving ? 'trending_down' : 'trending_up' }}
                                </span>
                                <span class="text-xs font-bold"
                                    [class]="category.isImproving ? 'text-emerald-400' : 'text-rose-400'">
                                    {{ category.percentChange | number:'1.1-1' }}%
                                </span>
                            </div>
                        </div>

                        <!-- Current Balance -->
                        <div class="mb-3">
                            <p class="text-3xl font-black text-white">
                                ${{ category.currentBalance | number:'1.0-0' }}
                            </p>
                            <p class="text-xs text-gray-400 mt-1">
                                <span [class]="category.isImproving ? 'text-emerald-400' : 'text-rose-400'">
                                    {{ category.isImproving ? '↓' : '↑' }}
                                    ${{ Math.abs(category.change) | number:'1.0-0' }}
                                </span>
                                from initial
                            </p>
                        </div>

                        <!-- Progress Bar -->
                        <div class="relative h-3 bg-gray-700 rounded-full overflow-hidden">
                            <div
                                class="absolute inset-0 flex items-center justify-center text-[10px] font-bold text-white z-10">
                                {{ category.initialBalance > 0 ? ((category.currentBalance / category.initialBalance) *
                                100 | number:'1.0-0') : 0 }}%
                            </div>
                            <div class="h-full transition-all duration-500 rounded-full"
                                [style.background-color]="category.color"
                                [style.width.%]="category.initialBalance > 0 ? (category.currentBalance / category.initialBalance) * 100 : 0">
                            </div>
                        </div>

                        <!-- Initial Balance Label -->
                        <div class="flex justify-between mt-2 text-xs text-gray-400">
                            <span>Initial: ${{ category.initialBalance | number:'1.0-0' }}</span>
                            <span>Current: ${{ category.currentBalance | number:'1.0-0' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="space-y-6">
            <!-- Expected Payoff Timeline -->
            <div class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800">
                <h3 class="text-lg font-bold text-white mb-4">Expected Payoff Timeline</h3>
                <div class="space-y-4">
                    <div *ngFor="let item of payoffTimeline" class="flex items-center justify-between group">
                        <div class="flex-1 mr-4">
                            <div
                                class="bg-[#1e293b] p-3 rounded-lg border border-gray-700 group-hover:border-blue-500/50 transition-colors">
                                <p class="text-sm font-bold text-gray-200">{{ item.name }}</p>
                            </div>
                        </div>
                        <span class="text-xs font-bold text-gray-400 whitespace-nowrap">{{ item.date | date:'MMM yyyy'
                            }}</span>
                    </div>
                </div>
            </div>

            <!-- Strategy Cards -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-[#0f172a] rounded-2xl p-4 border border-gray-800 text-center">
                    <span
                        class="px-2 py-1 bg-indigo-500/20 text-indigo-400 text-xs font-bold rounded mb-2 inline-block">Snowball</span>
                    <p class="text-xs text-gray-400">Pays off in</p>
                    <p class="text-xl font-black text-white">7.4 years</p>
                    <p class="text-[10px] text-gray-500 mt-1">Saves 2,000 interest</p>
                </div>
                <div class="bg-[#0f172a] rounded-2xl p-4 border border-gray-800 text-center">
                    <span
                        class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs font-bold rounded mb-2 inline-block">Avalanche</span>
                    <p class="text-xs text-gray-400">Pays off in</p>
                    <p class="text-xl font-black text-white">6.8 years</p>
                    <p class="text-[10px] text-gray-500 mt-1">Saves 4,000 interest</p>
                </div>
            </div>

            <!-- Cash Flow -->
            <div class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800">
                <h3 class="text-lg font-bold text-white mb-4">Cash Flow</h3>
                <div class="flex items-center justify-between">
                    <div>
                        <div class="bg-[#1e293b] px-4 py-2 rounded-lg border border-gray-700 mb-2">
                            <span class="text-blue-400 font-bold">+ 200</span>
                        </div>
                        <p class="text-xs text-gray-400 max-w-[120px]">Your high APR debt is costing you $715 per month
                        </p>
                    </div>
                    <div class="relative w-24 h-24 flex items-center justify-center">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="48" cy="48" r="40" stroke="#1e293b" stroke-width="8" fill="none" />
                            <circle cx="48" cy="48" r="40" stroke="#10b981" stroke-width="8" fill="none"
                                stroke-dasharray="251" stroke-dashoffset="100" />
                        </svg>
                        <div class="absolute text-center">
                            <span class="text-2xl font-black text-white">56</span>
                            <p class="text-[8px] text-gray-400">Needs Improvement</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debt Health -->
            <div class="bg-[#0f172a] rounded-2xl p-6 border border-gray-800">
                <h3 class="text-lg font-bold text-white mb-4">Debt Health</h3>
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs text-gray-400 mb-4 max-w-[120px]">Paying an extra $300 month may improve your
                            progress</p>
                    </div>
                    <div class="relative w-24 h-24 flex items-center justify-center">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="48" cy="48" r="40" stroke="#1e293b" stroke-width="8" fill="none" />
                            <circle cx="48" cy="48" r="40" stroke="#3b82f6" stroke-width="8" fill="none"
                                stroke-dasharray="251" stroke-dashoffset="100" />
                        </svg>
                        <div class="absolute text-center">
                            <span class="text-2xl font-black text-white">56</span>
                            <p class="text-[8px] text-gray-400">Needs Improvement</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
