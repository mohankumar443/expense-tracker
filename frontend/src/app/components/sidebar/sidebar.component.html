<div
    [class]="'fixed left-0 top-0 h-screen backdrop-blur-xl bg-white/95 dark:bg-[#111827] shadow-2xl transition-all duration-300 ease-in-out z-[60] border-r border-gray-200/60 dark:border-slate-600/60 ring-1 ring-black/5 dark:ring-white/5 ' + (isCollapsed ? 'w-20' : 'w-72')">
    <div class="absolute inset-0 bg-gradient-to-br from-primary/5 via-purple-500/5 to-pink-500/5 pointer-events-none">
    </div>

    <!-- Toggle Button -->
    <button (click)="toggleSidebar()" title="{{ isCollapsed ? 'Expand sidebar' : 'Collapse sidebar' }}"
        class="absolute -right-3 top-6 bg-gradient-to-br from-primary to-purple-600 text-white rounded-full p-2 shadow-xl hover:shadow-2xl hover:scale-110 transition-all duration-300 z-50 ring-4 ring-white dark:ring-gray-900">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path *ngIf="isCollapsed" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 5l7 7-7 7" />
            <path *ngIf="!isCollapsed" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 19l-7-7 7-7" />
        </svg>
    </button>

    <div [class]="'h-full overflow-y-auto pt-24 ' + (isCollapsed ? 'px-2 pb-4' : 'px-4 pb-5')">
        <!-- Brand -->
        <div class="mb-5 flex items-center gap-3" *ngIf="!isCollapsed">
            <div
                class="w-9 h-9 rounded-xl bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center shadow-lg">
                <span class="material-icons text-white text-lg">blur_on</span>
            </div>
            <div>
                <h3 class="font-black text-sm text-gray-900 dark:text-white">Modus</h3>
                <p class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider">Analyze •
                    Optimize • Build • Freedom</p>
            </div>
        </div>


        <!-- Navigation -->
        <nav class="space-y-2">
            <ng-container *ngFor="let item of primaryNavItems">
                <button (click)="setActiveSection(item.id)" [title]="item.label" [class]="'group w-full flex items-center rounded-xl transition-all duration-200 ' +
                        (isCollapsed ? 'justify-center p-3' : 'gap-3 px-3 py-2.5') +
                        (activeSection === item.id ? ' bg-gradient-to-r from-primary to-purple-600 text-white shadow-lg' :
                        ' text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800/60')">
                    <span class="material-icons text-xl">{{ item.icon }}</span>
                    <span *ngIf="!isCollapsed" class="flex flex-col text-left">
                        <span class="font-semibold text-sm">{{ item.label }}</span>
                        <span *ngIf="item.hint"
                            class="text-[10px] text-gray-400 group-[.bg-gradient-to-r]:text-white/70">
                            {{ item.hint }}
                        </span>
                    </span>
                </button>
            </ng-container>

            <!-- Debt Hub -->
            <button (click)="toggleMore()" [title]="shouldShowMoreExpanded ? 'Hide sections' : 'Show sections'" [class]="'group w-full flex items-center rounded-xl transition-all duration-200 ' +
                    (isCollapsed ? 'justify-center p-3' : 'gap-3 px-3 py-2.5') +
                    (shouldShowMoreExpanded ? ' bg-gray-100 dark:bg-gray-800/70 text-gray-900 dark:text-gray-100' :
                    ' text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800/60')">
                <span class="material-icons text-xl">more_horiz</span>
                <span *ngIf="!isCollapsed" class="flex items-center justify-between w-full">
                    <span class="font-semibold text-sm">Debt Hub</span>
                    <span
                        class="px-2 py-0.5 rounded-full bg-gray-200 dark:bg-gray-700 text-[10px] font-bold text-gray-600 dark:text-gray-400">
                        {{ totalSecondaryCount }}
                    </span>
                </span>
                <span *ngIf="!isCollapsed" class="material-icons text-base ml-auto">
                    {{ shouldShowMoreExpanded ? 'expand_less' : 'expand_more' }}
                </span>
            </button>

            <div *ngIf="shouldShowMoreExpanded" class="space-y-2 pl-1">
                <ng-container *ngFor="let item of secondaryNavItems">
                    <button (click)="setActiveSection(item.id)" [title]="item.label" [class]="'group w-full flex items-center rounded-xl transition-all duration-200 ' +
                            (isCollapsed ? 'justify-center p-3' : 'gap-3 px-3 py-2.5') +
                            (activeSection === item.id ? ' bg-gradient-to-r from-primary to-purple-600 text-white shadow-lg' :
                            ' text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800/60')">
                        <span class="material-icons text-xl">{{ item.icon }}</span>
                        <span *ngIf="!isCollapsed" class="font-semibold text-sm">{{ item.label }}</span>
                    </button>
                </ng-container>
            </div>

            <button (click)="setActiveSection('retirement')" title="Retirement" [class]="'group w-full flex items-center rounded-xl transition-all duration-200 ' +
                    (isCollapsed ? 'justify-center p-3' : 'gap-3 px-3 py-2.5') +
                    (activeSection === 'retirement' ? ' bg-gradient-to-r from-primary to-purple-600 text-white shadow-lg' :
                    ' text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800/60')">
                <span class="material-icons text-xl">savings</span>
                <span *ngIf="!isCollapsed" class="font-semibold text-sm">Retirement</span>
            </button>
        </nav>

        <!-- History -->
        <div *ngIf="!isCollapsed" class="mt-6">
            <div class="flex items-center justify-between mb-2">
                <p class="text-xs font-black text-gray-500 dark:text-gray-400 uppercase tracking-wider">History</p>
                <button (click)="loadSnapshots()"
                    class="text-xs text-gray-400 hover:text-primary transition-colors">Refresh</button>
            </div>
            <div class="space-y-2">
                <div *ngFor="let year of years">
                    <button (click)="toggleYear(year)"
                        class="w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800">
                        <span>{{ year }}</span>
                        <span class="material-icons text-sm">
                            {{ expandedYears[year] ? 'expand_less' : 'expand_more' }}
                        </span>
                    </button>
                    <div *ngIf="expandedYears[year]"
                        class="mt-1 ml-2 space-y-1 border-l border-gray-200 dark:border-gray-700 pl-2">
                        <div *ngFor="let snapshot of groupedSnapshots[year]" class="flex items-center group">
                            <button (click)="selectSnapshot(snapshot)"
                                class="flex-1 flex items-center px-2 py-1.5 rounded-lg text-xs text-gray-500 dark:text-gray-400 hover:text-primary hover:bg-primary/5 transition-colors">
                                <span class="w-1.5 h-1.5 rounded-full bg-gray-300 group-hover:bg-primary mr-2"></span>
                                {{ getMonthName(snapshot.snapshotDate) }}
                            </button>
                            <button (click)="deleteSnapshot(snapshot); $event.stopPropagation()"
                                class="opacity-0 group-hover:opacity-100 p-1 text-red-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all"
                                title="Delete this snapshot">
                                <span class="material-icons text-sm">delete</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteConfirmation" class="fixed inset-0 z-[70] flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" (click)="cancelDelete()"></div>
    <div
        class="relative bg-white dark:bg-[#1a2332] rounded-2xl shadow-xl w-full max-w-sm overflow-hidden animate-fade-in-up border border-gray-200 dark:border-gray-700">
        <div class="p-6 text-center">
            <div
                class="w-16 h-16 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="material-icons text-3xl">warning</span>
            </div>
            <h3 class="text-xl font-black text-gray-900 dark:text-white mb-2">Delete Snapshot?</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">{{ deleteConfirmationMessage }}</p>
            <div class="flex gap-3">
                <button (click)="cancelDelete()"
                    class="flex-1 px-4 py-2.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-bold rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                <button (click)="confirmDelete()"
                    class="flex-1 px-4 py-2.5 bg-red-600 text-white font-bold rounded-xl hover:bg-red-700 transition-colors shadow-lg shadow-red-500/20">Delete</button>
            </div>
        </div>
    </div>
</div>
