<div class="min-h-screen bg-[#0f1729] transition-colors duration-300">
    <!-- Header -->
    <header class="bg-[#1a2332] shadow-lg sticky top-0 z-50 border-b border-gray-700/50 transition-colors duration-300">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="material-icons text-4xl text-primary">account_balance_wallet</span>
                    <div>
                        <h1 class="text-3xl font-black text-white leading-tight">
                            Financial Life OS
                        </h1>
                        <p class="text-sm text-gray-300">Debt • Spending • Investments — {{ projectionLabel }}</p>
                    </div>
                </div>
                <div class="relative">
                    <button (click)="showProfileMenu = !showProfileMenu"
                        class="flex items-center space-x-2 px-4 py-2.5 rounded-xl bg-white/90 dark:bg-gray-800/90 backdrop-blur-md border border-gray-200 dark:border-gray-600 hover:bg-white dark:hover:bg-gray-700 transition-all duration-300 shadow-lg">
                        <div
                            class="w-8 h-8 rounded-lg bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center shadow-md">
                            <span class="material-icons text-white text-lg">person</span>
                        </div>
                        <div class="text-left">
                            <p class="text-xs text-gray-500 dark:text-gray-400 font-semibold">Profile</p>
                            <p class="text-sm font-bold text-gray-800 dark:text-gray-100 truncate">{{ activeProfile.name || 'Set up' }}</p>
                        </div>
                        <span class="material-icons text-gray-600 dark:text-gray-300 text-sm"
                            [class.rotate-180]="showProfileMenu">expand_more</span>
                    </button>

                    <div *ngIf="showProfileMenu"
                        class="absolute right-0 mt-3 w-[28rem] bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                            <p class="text-xs font-semibold text-blue-500 uppercase tracking-wide mb-2">Profile</p>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" [(ngModel)]="activeProfile.name" placeholder="Name"
                                    class="w-full bg-gray-50 dark:bg-[#0f1729] border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                                <input type="date" [(ngModel)]="activeProfile.dob" (ngModelChange)="onDobChange($event)"
                                    class="w-full bg-gray-50 dark:bg-[#0f1729] border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                                <input type="number" [ngModel]="activeProfile.age" readonly
                                    class="w-full bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm text-gray-900 dark:text-white">
                                <input type="number" [(ngModel)]="activeProfile.retirementAge" placeholder="Retirement Age"
                                    class="w-full bg-gray-50 dark:bg-[#0f1729] border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <div class="mt-3 flex items-center gap-2">
                                <select [(ngModel)]="activeProfile.id" (ngModelChange)="setActiveProfile($event)"
                                    class="flex-1 bg-gray-50 dark:bg-[#0f1729] border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                                    <option *ngFor="let p of profiles" [value]="p.id">{{ p.name || 'Unnamed Profile' }}</option>
                                </select>
                                <button (click)="addNewProfile()" class="px-3 py-2 rounded-lg text-xs font-bold border border-blue-200 dark:border-blue-700 text-blue-600 dark:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20">New</button>
                                <button (click)="saveActiveProfile()" class="px-3 py-2 rounded-lg text-xs font-bold bg-blue-600 text-white hover:bg-blue-700">Save</button>
                            </div>
                        </div>
                        <div class="p-4">
                            <p class="text-xs font-semibold text-blue-500 uppercase tracking-wide mb-2">Theme</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button *ngFor="let mode of modes" (click)="setTheme(mode.value); showProfileMenu = false"
                                    class="flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 text-sm font-semibold text-gray-700 dark:text-gray-200">
                                    <span class="material-icons text-base">{{ mode.icon }}</span>
                                    <span>{{ mode.label }}</span>
                                    <span *ngIf="(currentTheme$ | async) === mode.value" class="ml-auto text-blue-500 text-xs font-bold">Active</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <app-sidebar (sidebarToggled)="onSidebarToggled($event)"></app-sidebar>

    <!-- Main Content with dynamic padding for sidebar -->
    <div [class]="'transition-all duration-500 ' + (isSidebarCollapsed ? 'ml-20' : 'ml-72')">
        <div class="container mx-auto px-6 py-8">

            <!-- Debt Overview Section -->
            <div id="overview" class="scroll-mt-24">
                <app-debt-overview></app-debt-overview>
            </div>

            <!-- Strategy Command Center Section -->
            <div id="strategy" class="scroll-mt-24 mt-8">
                <app-strategy-dashboard></app-strategy-dashboard>
            </div>

            <!-- Progress Tracker Section -->
            <div id="progress" class="scroll-mt-24 mt-8">
                <app-progress-tracker></app-progress-tracker>
            </div>



            <!-- Debt Accounts Section -->
            <div id="accounts" class="scroll-mt-24 mt-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-black text-gray-900 dark:text-white mb-6">Your Debt Accounts</h2>
                    <app-debt-accounts-list></app-debt-accounts-list>
                </div>
            </div>

            <!-- Budget Tracker Section -->
            <div id="budget" class="scroll-mt-24 mt-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-black text-gray-900 dark:text-white mb-6">Budget & Expenses</h2>
                    <app-budget-tracker></app-budget-tracker>
                </div>
            </div>

            <!-- Recurring Expenses Section -->
            <div id="recurring" class="scroll-mt-24 mt-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-black text-gray-900 dark:text-white mb-6">Recurring Expenses & EMIs</h2>
                    <app-recurring-expenses></app-recurring-expenses>
                </div>
            </div>
        </div>
    </div>
</div>
